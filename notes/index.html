<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Public Notes - Share Your Thoughts</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-database-compat.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  <style>
/* Bulletin Board Background */
body {
  background: url('https://www.transparenttextures.com/patterns/cork-board.png');
  background-size: cover;
  padding: 2rem;
  font-family: sans-serif;
}

/* Message card looks like pinned notes */
.message-card {
  background-color: #fff8dc;
  border: 2px solid #d4a373;
  border-radius: 8px;
  padding: 1rem;
  box-shadow: 4px 4px 10px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
  transform: rotate(-1deg);
  position: relative;
  max-width: 300px;
  margin: 1rem;
}

.message-card::before {
  content: '';
  position: absolute;
  top: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 20px;
  height: 20px;
  background: radial-gradient(circle, #d22f27 30%, #a00 70%);
  border-radius: 50%;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  z-index: 10;
}

/* Pill style stays similar but fits board aesthetic */
.category-pill {
  background-color: #fdf6e3;
  border: 1px solid #e2c799;
  color: #5b3a29;
  border-radius: 9999px;
  padding: 0.25rem 0.75rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all 0.3s ease;
}

.category-pill:hover {
  transform: scale(1.05);
}

/* Gradient text for titles */
.gradient-text {
  background: linear-gradient(90deg, #d97706, #b91c1c);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  font-weight: bold;
}

/* Emoji picker fits board */
.emoji-picker {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0.5rem;
  background-color: #fff8dc;
  border: 1px solid #d4a373;
  padding: 0.5rem;
  border-radius: 8px;
}

.emoji-btn {
  cursor: pointer;
  transition: transform 0.2s;
}

.emoji-btn:hover {
  transform: scale(1.2);
}

/* Confetti can remain fun */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  background-color: #f00;
  animation: fall 3s linear forwards;
  z-index: 1000;
}

@keyframes fall {
  to {
    transform: translateY(100vh);
  }
}

/* Optional: remove wave to keep cork board aesthetic */
.wave-bottom {
  display: none;
}

  </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-pink-50 min-h-screen transition-colors duration-500">
  <div class="wave-bottom"></div>
  
  <div class="container mx-auto px-4 py-8 relative z-10">
    <header class="mb-8 text-center animate__animated animate__fadeInDown">
      <h1 class="text-4xl font-bold gradient-text mb-2">Public Notes</h1>
      <p class="text-gray-600 text-lg">Share your thoughts with the world - no registration required!</p>
      <div class="flex justify-center mt-4 space-x-2">
        <button id="toggleTheme" class="p-2 rounded-md bg-white hover:bg-gray-100 transition-colors shadow-md">
          <i class="fas fa-moon"></i>
        </button>
        <button id="toggleLanguage" class="p-2 rounded-md bg-white hover:bg-gray-100 transition-colors shadow-md">
          <i class="fas fa-language"></i> EN
        </button>
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-1">
        <div class="bg-white rounded-xl shadow-xl p-6 mb-8 animate__animated animate__fadeInLeft">
          <h2 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
            <i class="fas fa-pen-fancy mr-2 text-indigo-500"></i>
            <span>Create a Note</span>
          </h2>
          <form id="noteForm" class="space-y-4">
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700">Name*</label>
              <div class="mt-1 relative rounded-md shadow-sm">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fas fa-user text-gray-400"></i>
                </div>
                <input type="text" id="name" required placeholder="Anonymous" class="pl-10 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500">
              </div>
            </div>
            
            <div>
              <label for="message" class="block text-sm font-medium text-gray-700">Message*</label>
              <div class="mt-1 relative rounded-md shadow-sm">
                <textarea id="message" rows="4" required placeholder="Write your message here..." class="block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                <div class="absolute bottom-2 right-2 text-xs text-gray-500">
                  <span id="charCount">0</span>/300
                </div>
              </div>
            </div>
            
            <div>
              <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
              <div class="mt-1 relative rounded-md shadow-sm">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fas fa-tag text-gray-400"></i>
                </div>
                <select id="category" class="pl-10 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500">
                  <option value="general">General</option>
                  <option value="advice">Advice</option>
                  <option value="secret">Secret</option>
                  <option value="positive">Positive Thought</option>
                  <option value="question">Question</option>
                  <option value="idea">Idea</option>
                  <option value="funny">Funny</option>
                </select>
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">Background Color (optional)</label>
              <div class="mt-1 flex space-x-2">
                <span class="color-option w-8 h-8 rounded-full bg-white border-2 border-gray-300 cursor-pointer" data-color="white"></span>
                <span class="color-option w-8 h-8 rounded-full bg-yellow-100 border-2 border-gray-300 cursor-pointer" data-color="bg-yellow-100"></span>
                <span class="color-option w-8 h-8 rounded-full bg-green-100 border-2 border-gray-300 cursor-pointer" data-color="bg-green-100"></span>
                <span class="color-option w-8 h-8 rounded-full bg-blue-100 border-2 border-gray-300 cursor-pointer" data-color="bg-blue-100"></span>
                <span class="color-option w-8 h-8 rounded-full bg-purple-100 border-2 border-gray-300 cursor-pointer" data-color="bg-purple-100"></span>
                <span class="color-option w-8 h-8 rounded-full bg-pink-100 border-2 border-gray-300 cursor-pointer" data-color="bg-pink-100"></span>
              </div>
              <input type="hidden" id="bgColor" value="white">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">Add Reaction Emojis</label>
              <div class="mt-1 emoji-picker">
                <div class="emoji-option cursor-pointer text-center p-1" data-emoji="üëç">üëç</div>
                <div class="emoji-option cursor-pointer text-center p-1" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</div>
                <div class="emoji-option cursor-pointer text-center p-1" data-emoji="üòÇ">üòÇ</div>
                <div class="emoji-option cursor-pointer text-center p-1" data-emoji="üéâ">üéâ</div>
                <div class="emoji-option cursor-pointer text-center p-1" data-emoji="ü§î">ü§î</div>
              </div>
              <div id="selectedEmojis" class="mt-2 flex flex-wrap gap-1"></div>
              <input type="hidden" id="emojiList" value="">
            </div>
            
            <div class="flex justify-end">
              <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors shadow-md flex items-center">
                <i class="fas fa-paper-plane mr-2"></i>
                <span>Submit</span>
              </button>
            </div>
          </form>
        </div>
        
        <div class="bg-white rounded-xl shadow-xl p-6 animate__animated animate__fadeInLeft">
          <h2 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
            <i class="fas fa-chart-pie mr-2 text-indigo-500"></i>
            <span>Statistics</span>
          </h2>
          <div class="space-y-4">
            <div class="bg-indigo-50 p-4 rounded-lg">
              <p class="text-sm text-gray-600">Total Messages</p>
              <p id="totalMessages" class="text-3xl font-bold text-indigo-600">0</p>
            </div>
            <div class="bg-pink-50 p-4 rounded-lg">
              <p class="text-sm text-gray-600">Most Popular Category</p>
              <p id="popularCategory" class="text-xl font-bold text-pink-600">-</p>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
              <p class="text-sm text-gray-600">Most Recent</p>
              <p id="mostRecent" class="text-md font-medium text-green-600">-</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="lg:col-span-2 animate__animated animate__fadeInRight">
        <div class="bg-white rounded-xl shadow-xl p-6">
          <div class="flex justify-between items-center mb-6 flex-wrap gap-2">
            <h2 class="text-xl font-semibold text-gray-800 flex items-center">
              <i class="fas fa-comments mr-2 text-indigo-500"></i>
              <span>Messages</span>
            </h2>
            <div class="flex space-x-2 items-center">
              <div class="relative">
                <input type="text" id="searchMessages" placeholder="Search..." class="rounded-md border-gray-300 shadow-sm p-2 text-sm border w-40 focus:ring-indigo-500 focus:border-indigo-500">
                <i class="fas fa-search absolute right-3 top-2.5 text-gray-400"></i>
              </div>
              <select id="sortMessages" class="rounded-md border-gray-300 shadow-sm p-2 text-sm border">
                <option value="newest">Newest first</option>
                <option value="oldest">Oldest first</option>
                <option value="popular">Most popular</option>
              </select>
              <select id="filterCategory" class="rounded-md border-gray-300 shadow-sm p-2 text-sm border">
                <option value="all">All categories</option>
                <option value="general">General</option>
                <option value="advice">Advice</option>
                <option value="secret">Secret</option>
                <option value="positive">Positive Thought</option>
                <option value="question">Question</option>
                <option value="idea">Idea</option>
                <option value="funny">Funny</option>
              </select>
            </div>
          </div>
          
          <div id="categoriesFilter" class="flex flex-wrap gap-2 mb-6">
            <button class="category-pill bg-indigo-100 text-indigo-800 active" data-category="all">All</button>
            <button class="category-pill bg-blue-100 text-blue-800" data-category="general">General</button>
            <button class="category-pill bg-yellow-100 text-yellow-800" data-category="advice">Advice</button>
            <button class="category-pill bg-purple-100 text-purple-800" data-category="secret">Secret</button>
            <button class="category-pill bg-pink-100 text-pink-800" data-category="positive">Positive</button>
            <button class="category-pill bg-green-100 text-green-800" data-category="question">Question</button>
            <button class="category-pill bg-red-100 text-red-800" data-category="idea">Idea</button>
            <button class="category-pill bg-orange-100 text-orange-800" data-category="funny">Funny</button>
          </div>
          
          <div id="messagesList" class="space-y-4">
            <div class="text-center text-gray-500 py-8 animate-pulse">
              <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
              <p>Loading messages...</p>
            </div>
          </div>
          
          <div id="pagination" class="mt-6 flex justify-center space-x-2">
            <!-- Pagination will be added here dynamically -->
          </div>
        </div>
      </div>
    </div>
    
    <footer class="mt-12 text-center text-gray-500 text-sm">
      <p>¬© 2025 Public Notes | Made with <i class="fas fa-heart text-pink-500"></i> | <a href="#" id="showAbout" class="text-indigo-500 hover:underline">About</a></p>
    </footer>
    
    <!-- Modal for message actions -->
    <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
      <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
        <h3 class="text-lg font-bold mb-4">Message Actions</h3>
        <div class="space-y-4">
          <button id="copyLink" class="w-full p-2 bg-indigo-100 text-indigo-700 rounded-md hover:bg-indigo-200 flex items-center justify-center">
            <i class="fas fa-link mr-2"></i> Copy Link
          </button>
          <button id="shareMessage" class="w-full p-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 flex items-center justify-center">
            <i class="fas fa-share-alt mr-2"></i> Share
          </button>
          <button id="reportMessage" class="w-full p-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 flex items-center justify-center">
            <i class="fas fa-flag mr-2"></i> Report
          </button>
        </div>
        <div class="mt-6 text-right">
          <button id="closeModal" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">Close</button>
        </div>
      </div>
    </div>
    
    <!-- About modal -->
    <div id="aboutModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
      <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
        <h3 class="text-lg font-bold mb-4">About Public Notes</h3>
        <p class="mb-4">Public Notes is a platform where you can share thoughts, ideas, advice, or anything else with the world, anonymously and without registration.</p>
        <p class="mb-4">Features include:</p>
        <ul class="list-disc pl-5 mb-4 space-y-1">
          <li>Post messages in different categories</li>
          <li>React to others' messages</li>
          <li>Dark mode & light mode</li>
          <li>Customize your message appearance</li>
          <li>Search and filter functionality</li>
        </ul>
        <div class="mt-6 text-right">
          <button id="closeAboutModal" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Got it!</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      // Insert your Firebase configuration data here
      databaseURL: "https://public-notes-uzenofal-default-rtdb.europe-west1.firebasedatabase.app/"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const messagesRef = database.ref('messages');
    
    // DOM elements
    const noteForm = document.getElementById('noteForm');
    const nameInput = document.getElementById('name');
    const messageInput = document.getElementById('message');
    const categorySelect = document.getElementById('category');
    const messagesList = document.getElementById('messagesList');
    const filterCategory = document.getElementById('filterCategory');
    const toggleThemeBtn = document.getElementById('toggleTheme');
    const searchInput = document.getElementById('searchMessages');
    const sortSelect = document.getElementById('sortMessages');
    const charCount = document.getElementById('charCount');
    const totalMessagesEl = document.getElementById('totalMessages');
    const popularCategoryEl = document.getElementById('popularCategory');
    const mostRecentEl = document.getElementById('mostRecent');
    const categoryPills = document.querySelectorAll('.category-pill');
    const bgColorInput = document.getElementById('bgColor');
    const colorOptions = document.querySelectorAll('.color-option');
    const emojiOptions = document.querySelectorAll('.emoji-option');
    const selectedEmojisDiv = document.getElementById('selectedEmojis');
    const emojiListInput = document.getElementById('emojiList');
    const messageModal = document.getElementById('messageModal');
    const closeModal = document.getElementById('closeModal');
    const copyLink = document.getElementById('copyLink');
    const shareMessage = document.getElementById('shareMessage');
    const reportMessage = document.getElementById('reportMessage');
    const aboutModal = document.getElementById('aboutModal');
    const showAbout = document.getElementById('showAbout');
    const closeAboutModal = document.getElementById('closeAboutModal');
    const toggleLanguage = document.getElementById('toggleLanguage');
    
    // App state
    let darkMode = false;
    let currentLanguage = 'en';
    let currentPage = 1;
    let messagesPerPage = 5;
    let selectedMessageId = null;
    let selectedEmojis = [];
    
    // Character counter
    messageInput.addEventListener('input', () => {
      const count = messageInput.value.length;
      charCount.textContent = count;
      
      if (count > 300) {
        charCount.classList.add('text-red-500');
      } else {
        charCount.classList.remove('text-red-500');
      }
    });
    
    // Color selection
    colorOptions.forEach(option => {
      option.addEventListener('click', () => {
        colorOptions.forEach(o => o.classList.remove('border-indigo-500', 'border-4'));
        option.classList.add('border-indigo-500', 'border-4');
        bgColorInput.value = option.getAttribute('data-color');
      });
    });
    
    // Emoji selection
    emojiOptions.forEach(option => {
      option.addEventListener('click', () => {
        const emoji = option.getAttribute('data-emoji');
        
        if (selectedEmojis.includes(emoji)) {
          selectedEmojis = selectedEmojis.filter(e => e !== emoji);
          option.classList.remove('bg-indigo-100');
        } else {
          if (selectedEmojis.length < 3) {
            selectedEmojis.push(emoji);
            option.classList.add('bg-indigo-100');
          } else {
            showNotification("You can only select up to 3 reaction emojis", "warning");
          }
        }
        
        updateSelectedEmojisDisplay();
      });
    });
    
    function updateSelectedEmojisDisplay() {
      selectedEmojisDiv.innerHTML = '';
      emojiListInput.value = selectedEmojis.join(',');
      
      selectedEmojis.forEach(emoji => {
        const span = document.createElement('span');
        span.className = 'inline-block bg-gray-100 rounded-full px-3 py-1 text-sm';
        span.innerHTML = `${emoji} <i class="fas fa-times ml-1 cursor-pointer text-gray-500 remove-emoji" data-emoji="${emoji}"></i>`;
        selectedEmojisDiv.appendChild(span);
      });
      
      document.querySelectorAll('.remove-emoji').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const emoji = e.target.getAttribute('data-emoji');
          selectedEmojis = selectedEmojis.filter(e => e !== emoji);
          updateSelectedEmojisDisplay();
          
          // Update the emoji picker UI
          document.querySelector(`.emoji-option[data-emoji="${emoji}"]`).classList.remove('bg-indigo-100');
        });
      });
    }
    
    // Send message
    noteForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = nameInput.value.trim() || 'Anonymous';
      const message = messageInput.value.trim();
      const category = categorySelect.value;
      const bgColor = bgColorInput.value;
      
      if (message) {
        if (message.length > 300) {
          showNotification("Message is too long. Maximum 300 characters allowed.", "error");
          return;
        }
        
        // Add new message to Firebase
        messagesRef.push({
          name,
          message,
          category,
          bgColor,
          timestamp: Date.now(),
          likes: 0,
          reactionEmojis: selectedEmojis,
          reactions: {}
        }).then(() => {
          // Clear form
          nameInput.value = '';
          messageInput.value = '';
          categorySelect.value = 'general';
          bgColorInput.value = 'white';
          charCount.textContent = '0';
          selectedEmojis = [];
          updateSelectedEmojisDisplay();
          colorOptions.forEach(o => o.classList.remove('border-indigo-500', 'border-4'));
          colorOptions[0].classList.add('border-indigo-500', 'border-4');
          
          showConfetti();
          showNotification("Your message has been posted successfully!", "success");
        });
      }
    });
    
    // Load and display messages
    messagesRef.on('value', (snapshot) => {
      const messages = snapshot.val();
      updateStats(messages);
      displayMessages(messages);
    });
    
    function updateStats(messages) {
      if (!messages) {
        totalMessagesEl.textContent = "0";
        popularCategoryEl.textContent = "-";
        mostRecentEl.textContent = "-";
        return;
      }
      
      const messagesArray = Object.values(messages);
      
      // Total messages
      totalMessagesEl.textContent = messagesArray.length;
      
      // Most popular category
      const categories = messagesArray.map(msg => msg.category);
      const categoryCounts = categories.reduce((acc, cat) => {
        acc[cat] = (acc[cat] || 0) + 1;
        return acc;
      }, {});
      
      let maxCategory = null;
      let maxCount = 0;
      
      for (const [cat, count] of Object.entries(categoryCounts)) {
        if (count > maxCount) {
          maxCount = count;
          maxCategory = cat;
        }
      }
      
      popularCategoryEl.textContent = maxCategory ? `${maxCategory} (${maxCount})` : "-";
      
      // Most recent message
      const newestMessage = messagesArray.sort((a, b) => b.timestamp - a.timestamp)[0];
      if (newestMessage) {
        const timeAgo = moment(newestMessage.timestamp).fromNow();
        mostRecentEl.textContent = `${timeAgo}`;
      }
    }
    
    function displayMessages(messages, page = 1) {
      messagesList.innerHTML = '';
      
      if (messages) {
        // Convert messages to array
        let messagesArray = Object.entries(messages).map(([id, data]) => ({
          id,
          ...data
        }));
        
        // Filter by category if needed
        const currentFilter = filterCategory.value;
        if (currentFilter !== 'all') {
          messagesArray = messagesArray.filter(msg => msg.category === currentFilter);
        }
        
        // Search functionality
        const searchTerm = searchInput.value.toLowerCase();
        if (searchTerm) {
          messagesArray = messagesArray.filter(msg => 
            msg.message.toLowerCase().includes(searchTerm) || 
            msg.name.toLowerCase().includes(searchTerm)
          );
        }
        
        // Sort messages
        const sortMethod = sortSelect.value;
        switch(sortMethod) {
          case 'newest':
            messagesArray.sort((a, b) => b.timestamp - a.timestamp);
            break;
          case 'oldest':
            messagesArray.sort((a, b) => a.timestamp - b.timestamp);
            break;
          case 'popular':
            messagesArray.sort((a, b) => (b.likes || 0) - (a.likes || 0));
            break;
        }
        
        if (messagesArray.length === 0) {
          messagesList.innerHTML = `
            <div class="text-center text-gray-500 py-8">
              <i class="fas fa-search-minus text-4xl mb-2 opacity-50"></i>
              <p>No messages to display with the current filters.</p>
              <button id="clearFilters" class="mt-2 text-indigo-500 hover:underline">Clear filters</button>
            </div>
          `;
          
          document.getElementById('clearFilters')?.addEventListener('click', () => {
            searchInput.value = '';
            filterCategory.value = 'all';
            sortSelect.value = 'newest';
            categoryPills.forEach(pill => {
              pill.classList.remove('active');
              if (pill.getAttribute('data-category') === 'all') {
                pill.classList.add('active');
              }
            });
            displayMessages(messages);
          });
          
          return;
        }
        
        // Pagination
        const total = messagesArray.length;
        const totalPages = Math.ceil(total / messagesPerPage);
        const start = (page - 1) * messagesPerPage;
        const end = start + messagesPerPage;
        const pagedMessages = messagesArray.slice(start, end);
        
        // Display messages
        pagedMessages.forEach(msg => {
          const date = new Date(msg.timestamp);
          const formattedDate = moment(date).format('lll');
          const timeAgo = moment(date).fromNow();
          
          let categoryIcon, categoryColor;
          switch(msg.category) {
            case 'advice':
              categoryIcon = 'fa-lightbulb';
              categoryColor = 'text-yellow-600';
              break;
            case 'secret':
              categoryIcon = 'fa-user-secret';
              categoryColor = 'text-purple-600';
              break;
            case 'positive':
              categoryIcon = 'fa-heart';
              categoryColor = 'text-pink-600';
              break;
            case 'question':
              categoryIcon = 'fa-question-circle';
              categoryColor = 'text-green-600';
              break;
            case 'idea':
              categoryIcon = 'fa-bulb';
              categoryColor = 'text-red-600';
              break;
            case 'funny':
              categoryIcon = 'fa-laugh';
              categoryColor = 'text-orange-600';
              break;
            default:
              categoryIcon = 'fa-comment';
              categoryColor = 'text-blue-600';
          }
          
          const bgColorClass = msg.bgColor && msg.bgColor !== 'white' ? msg.bgColor : 'bg-white';
          
          const messageEl = document.createElement('div');
          messageEl.className = `message-card ${bgColorClass} rounded-xl shadow-md overflow-hidden transition-all`;
          messageEl.id = `message-${msg.id}`;
          
          let reactionsHTML = '';
          if (msg.reactionEmojis && msg.reactionEmojis.length > 0) {
            reactionsHTML = `
              <div class="flex justify-end space-x-2 mt-2">
                ${msg.reactionEmojis.map(emoji => {
                  const count = msg.reactions && msg.reactions[emoji] ? msg.reactions[emoji] : 0;
                  return `
                    <button class="reaction-btn flex items-center space-x-1 bg-gray-100 hover:bg-gray-200 rounded-full px-2 py-1 text-sm transition-colors" data-message="${msg.id}" data-emoji="${emoji}">
                      <span>${emoji}</span>
                      <span class="reaction-count">${count}</span>
                    </button>
                  `;
                }).join('')}
              </div>
            `;
          }
          
          messageEl.innerHTML = `
            <div class="p-5">
              <div class="flex justify-between items-start">
                <div class="flex items-center">
                  <div class="bg-indigo-100 rounded-full w-10 h-10 flex items-center justify-center mr-3">
                    <i class="fas fa-user text-indigo-500"></i>
                  </div>
                  <div>
                    <h3 class="font-semibold">${msg.name}</h3>
                    <p class="text-xs text-gray-500" title="${formattedDate}">${timeAgo}</p>
                  </div>
                </div>
                <div class="flex items-center space-x-2">
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs ${categoryColor} bg-opacity-20 bg-${categoryColor.split('-')[1]}-100">
                    <i class="fas ${categoryIcon} mr-1"></i>
                    ${msg.category}
                  </span>
                  <button class="message-options p-1 text-gray-400 hover:text-gray-600" data-id="${msg.id}">
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                </div>
              </div>
              <div class="mt-3 message-content">
                <p class="text-gray-700 whitespace-pre-line">${msg.message}</p>
              </div>
              ${reactionsHTML}
              <div class="flex justify-between items-center mt-4">
                <button class="like-button flex items-center text-gray-500 hover:text-indigo-600 transition-colors" data-id="${msg.id}">
                  <i class="far fa-heart mr-1"></i>
                  <span class="like-count">${msg.likes || 0}</span>
                </button>
                <div class="text-gray-400 text-sm">#${msg.id.slice(0, 6)}</div>
              </div>
            </div>
          `;
          
          messagesList.appendChild(messageEl);
        });
        
        // Set up reactions
        document.querySelectorAll('.reaction-btn').forEach(btn => {
          btn.addEventListener('click', e => {
            const messageId = btn.getAttribute('data-message');
            const emoji = btn.getAttribute('data-emoji');
            
            const messageRef = messagesRef.child(messageId);
            const reactionRef = messageRef.child('reactions').child(emoji);
            
            reactionRef.transaction(currentCount => {
              return (currentCount || 0) + 1;
            });
          });
        });
        
        // Set up like buttons
        document.querySelectorAll('.like-button').forEach(btn => {
          btn.addEventListener('click', e => {
            const messageId = btn.getAttribute('data-id');
            const messageRef = messagesRef.child(messageId);
            
            messageRef.child('likes').transaction(currentLikes => {
              return (currentLikes || 0) + 1;
            });
            
            btn.classList.add('text-indigo-600');
            btn.querySelector('i').classList.remove('far');
            btn.querySelector('i').classList.add('fas');
          });
        });
        
        // Set up message option buttons
        document.querySelectorAll('.message-options').forEach(btn => {
          btn.addEventListener('click', e => {
            selectedMessageId = btn.getAttribute('data-id');
            messageModal.classList.remove('hidden');
          });
        });
        
        // Pagination
        renderPagination(totalPages, page);
      } else {
        messagesList.innerHTML = `
          <div class="text-center text-gray-500 py-8">
            <i class="fas fa-comment-slash text-4xl mb-2 opacity-50"></i>
            <p>No messages yet. Be the first to share your thoughts!</p>
          </div>
        `;
      }
    }
    
    function renderPagination(totalPages, currentPage) {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      
      if (totalPages <= 1) return;
      
      const createPageButton = (pageNum, label, isActive = false, isDisabled = false) => {
        const btn = document.createElement('button');
        btn.className = `px-3 py-1 rounded-md ${isActive ? 'bg-indigo-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'} ${isDisabled ? 'opacity-50 cursor-not-allowed' : ''}`;
        btn.innerHTML = label;
        btn.disabled = isDisabled;
        
        if (!isDisabled) {
          btn.addEventListener('click', () => {
            currentPage = pageNum;
            messagesRef.once('value', snapshot => {
              displayMessages(snapshot.val(), pageNum);
            });
          });
        }
        
        return btn;
      };
      
      // Previous button
      pagination.appendChild(createPageButton(currentPage - 1, '<i class="fas fa-chevron-left"></i>', false, currentPage === 1));
      
      // Page numbers
      let startPage = Math.max(1, currentPage - 2);
      let endPage = Math.min(totalPages, startPage + 4);
      
      if (endPage - startPage < 4) {
        startPage = Math.max(1, endPage - 4);
      }
      
      for (let i = startPage; i <= endPage; i++) {
        pagination.appendChild(createPageButton(i, i, i === currentPage));
      }
      
      // Next button
      pagination.appendChild(createPageButton(currentPage + 1, '<i class="fas fa-chevron-right"></i>', false, currentPage === totalPages));
    }
    
    // Search, sort, and filter functionality
    searchInput.addEventListener('input', () => {
      messagesRef.once('value', snapshot => {
        displayMessages(snapshot.val(), 1);
      });
    });
    
    sortSelect.addEventListener('change', () => {
      messagesRef.once('value', snapshot => {
        displayMessages(snapshot.val(), 1);
      });
    });
    
    filterCategory.addEventListener('change', () => {
      // Update the category pills to match the dropdown
      categoryPills.forEach(pill => {
        pill.classList.remove('active');
        if (pill.getAttribute('data-category') === filterCategory.value) {
          pill.classList.add('active');
        }
      });
      
      messagesRef.once('value', snapshot => {
        displayMessages(snapshot.val(), 1);
      });
    });
    
    // Category pills
    categoryPills.forEach(pill => {
      pill.addEventListener('click', () => {
        categoryPills.forEach(p => p.classList.remove('active'));
        pill.classList.add('active');
        
        const category = pill.getAttribute('data-category');
        filterCategory.value = category;
        
        messagesRef.once('value', snapshot => {
          displayMessages(snapshot.val(), 1);
        });
      });
    });
    
    // Theme toggle
    toggleThemeBtn.addEventListener('click', () => {
      darkMode = !darkMode;
      
      if (darkMode) {
        document.body.classList.remove('bg-gradient-to-br', 'from-indigo-50', 'to-pink-50');
        document.body.classList.add('bg-gray-900');
        toggleThemeBtn.innerHTML = '<i class="fas fa-sun"></i>';
      } else {
        document.body.classList.add('bg-gradient-to-br', 'from-indigo-50', 'to-pink-50');
        document.body.classList.remove('bg-gray-900');
        toggleThemeBtn.innerHTML = '<i class="fas fa-moon"></i>';
      }
      
      // Toggle dark mode classes on all elements
      const elementsToToggle = document.querySelectorAll('.bg-white, .text-gray-700, .text-gray-600, .text-gray-500, .text-gray-800');
      
      elementsToToggle.forEach(el => {
        if (darkMode) {
          if (el.classList.contains('bg-white')) {
            el.classList.remove('bg-white');
            el.classList.add('bg-gray-800');
          }
          
          if (el.classList.contains('text-gray-700')) {
            el.classList.remove('text-gray-700');
            el.classList.add('text-gray-300');
          }
          
          if (el.classList.contains('text-gray-600')) {
            el.classList.remove('text-gray-600');
            el.classList.add('text-gray-400');
          }
          
          if (el.classList.contains('text-gray-500')) {
            el.classList.remove('text-gray-500');
            el.classList.add('text-gray-400');
          }
          
          if (el.classList.contains('text-gray-800')) {
            el.classList.remove('text-gray-800');
            el.classList.add('text-gray-200');
          }
        } else {
          if (el.classList.contains('bg-gray-800')) {
            el.classList.remove('bg-gray-800');
            el.classList.add('bg-white');
          }
          
          if (el.classList.contains('text-gray-300')) {
            el.classList.remove('text-gray-300');
            el.classList.add('text-gray-700');
          }
          
          if (el.classList.contains('text-gray-400')) {
            el.classList.remove('text-gray-400');
            if (el.classList.contains('text-gray-500-light')) {
              el.classList.add('text-gray-500');
            } else {
              el.classList.add('text-gray-600');
            }
          }
          
          if (el.classList.contains('text-gray-200')) {
            el.classList.remove('text-gray-200');
            el.classList.add('text-gray-800');
          }
        }
      });
    });
    
    // Language toggle
    toggleLanguage.addEventListener('click', () => {
      if (currentLanguage === 'en') {
        currentLanguage = 'es';
        toggleLanguage.innerHTML = '<i class="fas fa-language"></i> ES';
        translateUI('es');
      } else {
        currentLanguage = 'en';
        toggleLanguage.innerHTML = '<i class="fas fa-language"></i> EN';
        translateUI('en');
      }
    });
    
    function translateUI(lang) {
      const translations = {
        en: {
          title: 'Public Notes',
          subtitle: 'Share your thoughts with the world - no registration required!',
          createNote: 'Create a Note',
          name: 'Name (optional)',
          message: 'Message*',
          category: 'Category',
          bgColor: 'Background Color (optional)',
          addReactions: 'Add Reaction Emojis',
          submit: 'Submit',
          statistics: 'Statistics',
          totalMessages: 'Total Messages',
          popularCategory: 'Most Popular Category',
          mostRecent: 'Most Recent',
          messages: 'Messages',
          search: 'Search...',
          newestFirst: 'Newest first',
          oldestFirst: 'Oldest first',
          mostPopular: 'Most popular',
          allCategories: 'All categories',
          noMessages: 'No messages yet. Be the first to share your thoughts!',
          noResults: 'No messages to display with the current filters.',
          clearFilters: 'Clear filters',
          about: 'About',
          madeWith: 'Made with',
          messageActions: 'Message Actions',
          copyLink: 'Copy Link',
          share: 'Share',
          report: 'Report',
          close: 'Close',
          aboutTitle: 'About Public Notes',
          aboutText: 'Public Notes is a platform where you can share thoughts, ideas, advice, or anything else with the world, anonymously and without registration.',
          features: 'Features include:',
          feature1: 'Post messages in different categories',
          feature2: 'React to others\' messages',
          feature3: 'Dark mode & light mode',
          feature4: 'Customize your message appearance',
          feature5: 'Search and filter functionality',
          gotIt: 'Got it!'
        },
        es: {
          title: 'Notas P√∫blicas',
          subtitle: 'Comparte tus pensamientos con el mundo - sin registro necesario!',
          createNote: 'Crear Nota',
          name: 'Nombre (opcional)',
          message: 'Mensaje*',
          category: 'Categor√≠a',
          bgColor: 'Color de Fondo (opcional)',
          addReactions: 'A√±adir Emojis de Reacci√≥n',
          submit: 'Enviar',
          statistics: 'Estad√≠sticas',
          totalMessages: 'Mensajes Totales',
          popularCategory: 'Categor√≠a m√°s Popular',
          mostRecent: 'M√°s Reciente',
          messages: 'Mensajes',
          search: 'Buscar...',
          newestFirst: 'M√°s recientes primero',
          oldestFirst: 'M√°s antiguos primero',
          mostPopular: 'M√°s populares',
          allCategories: 'Todas las categor√≠as',
          noMessages: '¬°No hay mensajes a√∫n. S√© el primero en compartir tus pensamientos!',
          noResults: 'No hay mensajes para mostrar con los filtros actuales.',
          clearFilters: 'Borrar filtros',
          about: 'Acerca de',
          madeWith: 'Hecho con',
          messageActions: 'Acciones del Mensaje',
          copyLink: 'Copiar Enlace',
          share: 'Compartir',
          report: 'Reportar',
          close: 'Cerrar',
          aboutTitle: 'Acerca de Notas P√∫blicas',
          aboutText: 'Notas P√∫blicas es una plataforma donde puedes compartir pensamientos, ideas, consejos o cualquier otra cosa con el mundo, de forma an√≥nima y sin registro.',
          features: 'Las caracter√≠sticas incluyen:',
          feature1: 'Publicar mensajes en diferentes categor√≠as',
          feature2: 'Reaccionar a los mensajes de otros',
          feature3: 'Modo oscuro y claro',
          feature4: 'Personalizar la apariencia de tu mensaje',
          feature5: 'Funcionalidad de b√∫squeda y filtrado',
          gotIt: '¬°Entendido!'
        }
      };
      
      document.querySelector('h1').textContent = translations[lang].title;
      document.querySelector('header p').textContent = translations[lang].subtitle;
      // And so on for all other UI elements...
      
      // Update category options
      if (lang === 'es') {
        categorySelect.innerHTML = `
          <option value="general">General</option>
          <option value="advice">Consejo</option>
          <option value="secret">Secreto</option>
          <option value="positive">Pensamiento Positivo</option>
          <option value="question">Pregunta</option>
          <option value="idea">Idea</option>
          <option value="funny">Divertido</option>
        `;
        
        filterCategory.innerHTML = `
          <option value="all">Todas las categor√≠as</option>
          <option value="general">General</option>
          <option value="advice">Consejo</option>
          <option value="secret">Secreto</option>
          <option value="positive">Pensamiento Positivo</option>
          <option value="question">Pregunta</option>
          <option value="idea">Idea</option>
          <option value="funny">Divertido</option>
        `;
      } else {
        categorySelect.innerHTML = `
          <option value="general">General</option>
          <option value="advice">Advice</option>
          <option value="secret">Secret</option>
          <option value="positive">Positive Thought</option>
          <option value="question">Question</option>
          <option value="idea">Idea</option>
          <option value="funny">Funny</option>
        `;
        
        filterCategory.innerHTML = `
          <option value="all">All categories</option>
          <option value="general">General</option>
          <option value="advice">Advice</option>
          <option value="secret">Secret</option>
          <option value="positive">Positive Thought</option>
          <option value="question">Question</option>
          <option value="idea">Idea</option>
          <option value="funny">Funny</option>
        `;
      }
      
      // Refresh message display to update timestamps and category labels
      messagesRef.once('value', snapshot => {
        displayMessages(snapshot.val(), currentPage);
      });
    }
    
    // Modal functionality
    closeModal.addEventListener('click', () => {
      messageModal.classList.add('hidden');
      selectedMessageId = null;
    });
    
    copyLink.addEventListener('click', () => {
      const url = `${window.location.origin}${window.location.pathname}?msg=${selectedMessageId}`;
      navigator.clipboard.writeText(url).then(() => {
        showNotification("Link copied to clipboard!", "success");
        messageModal.classList.add('hidden');
      });
    });
    
    shareMessage.addEventListener('click', () => {
      if (navigator.share) {
        navigator.share({
          title: 'Check out this note on Public Notes',
          text: 'I found this interesting note on Public Notes',
          url: `${window.location.origin}${window.location.pathname}?msg=${selectedMessageId}`
        }).then(() => {
          messageModal.classList.add('hidden');
        });
      } else {
        copyLink.click();
      }
    });
    
    reportMessage.addEventListener('click', () => {
      if (confirm("Are you sure you want to report this message?")) {
        database.ref(`reports/${selectedMessageId}`).set({
          timestamp: Date.now(),
          reported: true
        }).then(() => {
          showNotification("Message reported. Thank you for helping keep our community safe.", "info");
          messageModal.classList.add('hidden');
        });
      }
    });
    
    // About modal
    showAbout.addEventListener('click', (e) => {
      e.preventDefault();
      aboutModal.classList.remove('hidden');
    });
    
    closeAboutModal.addEventListener('click', () => {
      aboutModal.classList.add('hidden');
    });
    
    // Notification system
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      
      let bgColor, icon;
      switch (type) {
        case 'success':
          bgColor = 'bg-green-500';
          icon = 'fa-check-circle';
          break;
        case 'error':
          bgColor = 'bg-red-500';
          icon = 'fa-exclamation-circle';
          break;
        case 'warning':
          bgColor = 'bg-yellow-500';
          icon = 'fa-exclamation-triangle';
          break;
        default:
          bgColor = 'bg-blue-500';
          icon = 'fa-info-circle';
      }
      
      notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-3 rounded-md shadow-lg flex items-center animate__animated animate__fadeInRight max-w-md z-50`;
      notification.innerHTML = `
        <i class="fas ${icon} mr-3 text-xl"></i>
        <p>${message}</p>
        <button class="ml-auto text-white hover:text-gray-200">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      document.body.appendChild(notification);
      
      notification.querySelector('button').addEventListener('click', () => {
        notification.classList.replace('animate__fadeInRight', 'animate__fadeOutRight');
        setTimeout(() => {
          notification.remove();
        }, 500);
      });
      
      setTimeout(() => {
        notification.classList.replace('animate__fadeInRight', 'animate__fadeOutRight');
        setTimeout(() => {
          notification.remove();
        }, 500);
      }, 5000);
    }
    
    // Confetti animation
    function showConfetti() {
      const colors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'];
      
      for (let i = 0; i < 50; i++) {
        createConfetti(colors[Math.floor(Math.random() * colors.length)]);
      }
    }
    
    function createConfetti(color) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.backgroundColor = color;
      confetti.style.opacity = Math.random() + 0.5;
      confetti.style.width = Math.random() * 10 + 5 + 'px';
      confetti.style.height = Math.random() * 10 + 5 + 'px';
      confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
      confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
      document.body.appendChild(confetti);
      
      setTimeout(() => {
        confetti.remove();
      }, 5000);
    }
    
    // Check URL for message ID to display
    window.addEventListener('load', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const msgId = urlParams.get('msg');
      
      if (msgId) {
        database.ref(`messages/${msgId}`).once('value', snapshot => {
          if (snapshot.exists()) {
            const targetElement = document.getElementById(`message-${msgId}`);
            if (targetElement) {
              targetElement.scrollIntoView({ behavior: 'smooth' });
              targetElement.classList.add('animate__animated', 'animate__pulse');
              targetElement.style.boxShadow = '0 0 0 4px rgba(99, 102, 241, 0.5)';
            }
          }
        });
      }
    });
    
    // Initial call to display messages
    messagesRef.once('value', snapshot => {
      displayMessages(snapshot.val());
    });
  </script>
</body>
</html>