<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Public Notes - Share Your Thoughts</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-database-compat.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/confetti-js/0.0.18/confetti.min.js"></script>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-100 min-h-screen transition-all duration-500">
  <div class="container mx-auto px-4 py-8 max-w-5xl">
    <header class="mb-8 text-center animate__animated animate__fadeIn">
      <div class="flex justify-center mb-4">
        <div class="bg-white rounded-full p-3 shadow-lg">
          <i class="fas fa-comment-dots text-4xl text-indigo-600"></i>
        </div>
      </div>
      <h1 class="text-4xl font-bold text-indigo-700 mb-2">Public Notes</h1>
      <p class="text-gray-600 text-lg">Share your thoughts with the world - no registration required!</p>
      <div class="flex justify-center mt-4 space-x-2">
        <button id="themeSwitcher" class="bg-white rounded-full p-2 shadow hover:shadow-md transition-all">
          <i class="fas fa-palette text-indigo-600"></i>
          <span class="ml-2 text-sm font-medium">Theme</span>
        </button>
        <button id="statsButton" class="bg-white rounded-full p-2 shadow hover:shadow-md transition-all">
          <i class="fas fa-chart-simple text-indigo-600"></i>
          <span class="ml-2 text-sm font-medium">Stats</span>
        </button>
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Left Column - New Message Form -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-md p-6 mb-8 hover:shadow-lg transition-shadow animate__animated animate__fadeInLeft">
          <h2 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
            <i class="fas fa-pen-fancy mr-2 text-indigo-600"></i>
            Add a New Message
          </h2>
          <form id="noteForm" class="space-y-4">
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700">Name (optional)</label>
              <div class="mt-1 relative rounded-md shadow-sm">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fas fa-user text-gray-400"></i>
                </div>
                <input type="text" id="name" placeholder="Anonymous" class="pl-10 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500">
              </div>
            </div>
            
            <div>
              <label for="message" class="block text-sm font-medium text-gray-700">Message*</label>
              <div class="mt-1 relative rounded-md shadow-sm">
                <textarea id="message" rows="4" required placeholder="Write your message here... (Markdown supported)" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500"></textarea>
              </div>
              <div class="flex justify-between mt-1 text-xs text-gray-500">
                <span>Markdown supported</span>
                <span id="charCount">0/500</span>
              </div>
            </div>
            
            <div>
              <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
              <div class="mt-1 relative rounded-md shadow-sm">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fas fa-tag text-gray-400"></i>
                </div>
                <select id="category" class="pl-10 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500">
                  <option value="general">General</option>
                  <option value="advice">Advice</option>
                  <option value="secret">Secret</option>
                  <option value="positive">Positive Thought</option>
                  <option value="question">Question</option>
                  <option value="idea">Idea</option>
                  <option value="joke">Joke</option>
                </select>
              </div>
            </div>
            
            <div>
              <label for="mood" class="block text-sm font-medium text-gray-700">Mood</label>
              <div class="mt-1 flex space-x-2 overflow-x-auto pb-2">
                <button type="button" class="mood-selector p-2 rounded-full hover:bg-gray-100" data-mood="ðŸ˜Š">ðŸ˜Š</button>
                <button type="button" class="mood-selector p-2 rounded-full hover:bg-gray-100" data-mood="ðŸ˜¢">ðŸ˜¢</button>
                <button type="button" class="mood-selector p-2 rounded-full hover:bg-gray-100" data-mood="ðŸ˜Ž">ðŸ˜Ž</button>
                <button type="button" class="mood-selector p-2 rounded-full hover:bg-gray-100" data-mood="ðŸ˜‚">ðŸ˜‚</button>
                <button type="button" class="mood-selector p-2 rounded-full hover:bg-gray-100" data-mood="ðŸ˜¡">ðŸ˜¡</button>
                <button type="button" class="mood-selector p-2 rounded-full hover:bg-gray-100" data-mood="ðŸ¥°">ðŸ¥°</button>
                <button type="button" class="mood-selector p-2 rounded-full hover:bg-gray-100" data-mood="ðŸ¤”">ðŸ¤”</button>
                <button type="button" class="mood-selector p-2 rounded-full hover:bg-gray-100" data-mood="ðŸ˜´">ðŸ˜´</button>
              </div>
              <input type="hidden" id="selectedMood" value="">
            </div>
            
            <div>
              <label for="color" class="block text-sm font-medium text-gray-700">Background Color</label>
              <div class="mt-1 flex space-x-2">
                <button type="button" class="color-selector w-8 h-8 rounded-full border-2 border-transparent hover:border-gray-400" data-color="bg-white" style="background-color: white;"></button>
                <button type="button" class="color-selector w-8 h-8 rounded-full border-2 border-transparent hover:border-gray-400" data-color="bg-blue-100" style="background-color: #dbeafe;"></button>
                <button type="button" class="color-selector w-8 h-8 rounded-full border-2 border-transparent hover:border-gray-400" data-color="bg-green-100" style="background-color: #d1fae5;"></button>
                <button type="button" class="color-selector w-8 h-8 rounded-full border-2 border-transparent hover:border-gray-400" data-color="bg-yellow-100" style="background-color: #fef3c7;"></button>
                <button type="button" class="color-selector w-8 h-8 rounded-full border-2 border-transparent hover:border-gray-400" data-color="bg-red-100" style="background-color: #fee2e2;"></button>
                <button type="button" class="color-selector w-8 h-8 rounded-full border-2 border-transparent hover:border-gray-400" data-color="bg-purple-100" style="background-color: #ede9fe;"></button>
              </div>
              <input type="hidden" id="selectedColor" value="bg-white">
            </div>
            
            <div class="flex justify-end">
              <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors flex items-center space-x-2 transform hover:scale-105 transition-transform">
                <i class="fas fa-paper-plane"></i>
                <span>Submit</span>
              </button>
            </div>
          </form>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-8 animate__animated animate__fadeInLeft">
          <h2 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
            <i class="fas fa-filter mr-2 text-indigo-600"></i>
            Filters
          </h2>
          <div class="space-y-4">
            <div>
              <label for="filterCategory" class="block text-sm font-medium text-gray-700">Category</label>
              <select id="filterCategory" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500">
                <option value="all">All categories</option>
                <option value="general">General</option>
                <option value="advice">Advice</option>
                <option value="secret">Secret</option>
                <option value="positive">Positive Thought</option>
                <option value="question">Question</option>
                <option value="idea">Idea</option>
                <option value="joke">Joke</option>
              </select>
            </div>
            
            <div>
              <label for="sortBy" class="block text-sm font-medium text-gray-700">Sort by</label>
              <select id="sortBy" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500">
                <option value="newest">Newest first</option>
                <option value="oldest">Oldest first</option>
                <option value="popular">Most popular</option>
              </select>
            </div>
            
            <div>
              <label for="searchMessages" class="block text-sm font-medium text-gray-700">Search</label>
              <div class="mt-1 relative rounded-md shadow-sm">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fas fa-search text-gray-400"></i>
                </div>
                <input type="text" id="searchMessages" placeholder="Search messages..." class="pl-10 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500">
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Right Column - Messages -->
      <div class="lg:col-span-2 animate__animated animate__fadeInRight">
        <div class="bg-white rounded-lg shadow-md p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-gray-800 flex items-center">
              <i class="fas fa-comments mr-2 text-indigo-600"></i>
              Messages
            </h2>
            <div class="flex space-x-2">
              <button id="toggleDarkMode" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                <i class="fas fa-moon"></i>
              </button>
              <button id="refreshMessages" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
          </div>
          
          <div id="messagesList" class="space-y-4">
            <div class="text-center text-gray-500 py-8">
              <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
              <p>Loading messages...</p>
            </div>
          </div>
          
          <div class="mt-6 flex justify-center">
            <button id="loadMoreBtn" class="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-md hover:bg-indigo-200 transition-colors hidden">
              Load more messages
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Stats Modal -->
    <div id="statsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg shadow-lg p-6 max-w-lg w-full m-4 animate__animated animate__fadeInDown">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-gray-800">Message Statistics</h2>
          <button id="closeStatsBtn" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="statsContent" class="space-y-6">
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-indigo-50 p-4 rounded-lg text-center">
              <p class="text-indigo-800 text-sm">Total Messages</p>
              <p id="totalMessages" class="text-3xl font-bold text-indigo-600">0</p>
            </div>
            <div class="bg-green-50 p-4 rounded-lg text-center">
              <p class="text-green-800 text-sm">Total Likes</p>
              <p id="totalLikes" class="text-3xl font-bold text-green-600">0</p>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-medium text-gray-700 mb-2">Top Categories</h3>
            <div id="categoriesChart" class="h-40 bg-gray-50 rounded-lg p-2"></div>
          </div>
          
          <div>
            <h3 class="text-lg font-medium text-gray-700 mb-2">Activity Over Time</h3>
            <div id="timeChart" class="h-40 bg-gray-50 rounded-lg p-2"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Theme Selector Modal -->
    <div id="themeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg shadow-lg p-6 max-w-md w-full m-4 animate__animated animate__fadeInDown">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-gray-800">Choose a Theme</h2>
          <button id="closeThemeBtn" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <button class="theme-option p-4 rounded-lg border-2 border-transparent hover:border-indigo-500 flex flex-col items-center" data-theme="default">
            <div class="w-full h-20 bg-gradient-to-br from-indigo-50 to-purple-100 rounded mb-2"></div>
            <span class="text-sm font-medium">Default</span>
          </button>
          <button class="theme-option p-4 rounded-lg border-2 border-transparent hover:border-indigo-500 flex flex-col items-center" data-theme="ocean">
            <div class="w-full h-20 bg-gradient-to-br from-blue-50 to-cyan-100 rounded mb-2"></div>
            <span class="text-sm font-medium">Ocean</span>
          </button>
          <button class="theme-option p-4 rounded-lg border-2 border-transparent hover:border-indigo-500 flex flex-col items-center" data-theme="sunset">
            <div class="w-full h-20 bg-gradient-to-br from-orange-50 to-red-100 rounded mb-2"></div>
            <span class="text-sm font-medium">Sunset</span>
          </button>
          <button class="theme-option p-4 rounded-lg border-2 border-transparent hover:border-indigo-500 flex flex-col items-center" data-theme="forest">
            <div class="w-full h-20 bg-gradient-to-br from-green-50 to-emerald-100 rounded mb-2"></div>
            <span class="text-sm font-medium">Forest</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Message Preview Modal -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg shadow-lg p-6 max-w-lg w-full m-4 animate__animated animate__fadeInDown">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-gray-800">Message Preview</h2>
          <button id="closePreviewBtn" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="messagePreview" class="p-4 rounded-lg bg-gray-50 mb-4"></div>
        <div class="flex justify-end space-x-2">
          <button id="editMessageBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
            Edit
          </button>
          <button id="confirmPostBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors">
            Post Message
          </button>
        </div>
      </div>
    </div>
    
    <!-- Canvas for confetti -->
    <canvas id="confetti-canvas" class="fixed inset-0 pointer-events-none z-50 hidden"></canvas>
    
    <footer class="mt-12 text-center text-gray-500 text-sm">
      <p>Â© 2025 Public Notes - Connect with the world, one message at a time.</p>
      <div class="flex justify-center mt-2 space-x-4">
        <a href="#" class="hover:text-indigo-600 transition-colors"><i class="fab fa-twitter"></i></a>
        <a href="#" class="hover:text-indigo-600 transition-colors"><i class="fab fa-facebook"></i></a>
        <a href="#" class="hover:text-indigo-600 transition-colors"><i class="fab fa-instagram"></i></a>
        <a href="#" class="hover:text-indigo-600 transition-colors"><i class="fab fa-github"></i></a>
      </div>
    </footer>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      // Insert your Firebase configuration data here
      databaseURL: "https://public-notes-uzenofal-default-rtdb.europe-west1.firebasedatabase.app/"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const messagesRef = database.ref('messages');
    
    // DOM elements
    const noteForm = document.getElementById('noteForm');
    const nameInput = document.getElementById('name');
    const messageInput = document.getElementById('message');
    const categorySelect = document.getElementById('category');
    const charCount = document.getElementById('charCount');
    const messagesList = document.getElementById('messagesList');
    const filterCategory = document.getElementById('filterCategory');
    const sortBy = document.getElementById('sortBy');
    const searchMessages = document.getElementById('searchMessages');
    const toggleDarkModeBtn = document.getElementById('toggleDarkMode');
    const refreshMessagesBtn = document.getElementById('refreshMessages');
    const loadMoreBtn = document.getElementById('loadMoreBtn');
    const statsButton = document.getElementById('statsButton');
    const statsModal = document.getElementById('statsModal');
    const closeStatsBtn = document.getElementById('closeStatsBtn');
    const themeSwitcher = document.getElementById('themeSwitcher');
    const themeModal = document.getElementById('themeModal');
    const closeThemeBtn = document.getElementById('closeThemeBtn');
    const selectedMoodInput = document.getElementById('selectedMood');
    const selectedColorInput = document.getElementById('selectedColor');
    const previewModal = document.getElementById('previewModal');
    const messagePreview = document.getElementById('messagePreview');
    const closePreviewBtn = document.getElementById('closePreviewBtn');
    const editMessageBtn = document.getElementById('editMessageBtn');
    const confirmPostBtn = document.getElementById('confirmPostBtn');
    
    // Global variables
    let darkMode = false;
    let currentTheme = 'default';
    let messagesCache = [];
    let messagesPerPage = 10;
    let currentPage = 1;
    let confettiInstance = null;
    
    // Initialize confetti
    function initConfetti() {
      const canvas = document.getElementById('confetti-canvas');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      const confettiSettings = {
        target: 'confetti-canvas',
        max: 150,
        size: 1.5,
        animate: true,
        props: ['circle', 'square', 'triangle', 'line'],
        colors: [[165, 104, 246], [230, 61, 135], [0, 199, 228], [253, 214, 126]],
        clock: 25,
        interval: null,
        rotate: false,
        start_from_edge: true,
        respawn: true
      };
      
      return new ConfettiGenerator(confettiSettings);
    }
    
    // Celebrate new message
    function celebrate() {
      const canvas = document.getElementById('confetti-canvas');
      canvas.classList.remove('hidden');
      
      if (!confettiInstance) {
        confettiInstance = initConfetti();
      }
      
      confettiInstance.render();
      
      setTimeout(() => {
        confettiInstance.clear();
        canvas.classList.add('hidden');
      }, 3000);
    }
    
    // Character count
    messageInput.addEventListener('input', () => {
      const length = messageInput.value.length;
      charCount.textContent = `${length}/500`;
      
      if (length > 500) {
        charCount.classList.add('text-red-500');
      } else {
        charCount.classList.remove('text-red-500');
      }
    });
    
    // Mood selectors
    document.querySelectorAll('.mood-selector').forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all mood buttons
        document.querySelectorAll('.mood-selector').forEach(btn => {
          btn.classList.remove('bg-indigo-100');
        });
        
        // Add active class to clicked button
        button.classList.add('bg-indigo-100');
        
        // Set the selected mood value
        selectedMoodInput.value = button.getAttribute('data-mood');
      });
    });
    
    // Color selectors
    document.querySelectorAll('.color-selector').forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all color buttons
        document.querySelectorAll('.color-selector').forEach(btn => {
          btn.classList.remove('border-indigo-600');
        });
        
        // Add active class to clicked button
        button.classList.add('border-indigo-600');
        
        // Set the selected color value
        selectedColorInput.value = button.getAttribute('data-color');
      });
    });
    
    // Preview message before sending
    noteForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = nameInput.value.trim() || 'Anonymous';
      const message = messageInput.value.trim();
      const category = categorySelect.value;
      const mood = selectedMoodInput.value;
      const color = selectedColorInput.value;
      
      if (message) {
        if (message.length > 500) {
          alert('Your message is too long. Please limit it to 500 characters.');
          return;
        }
        
        // Show preview
        messagePreview.className = `p-4 rounded-lg ${color}`;
        
        const categoryIcon = getCategoryIcon(category);
        const formattedDate = formatDate(new Date());
        
        messagePreview.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <div class="font-medium">${name} ${mood}</div>
              <div class="text-sm text-gray-500 flex items-center gap-1">
                <i class="fas ${categoryIcon.icon} ${categoryIcon.color}"></i>
                <span>${formattedDate}</span>
              </div>
            </div>
          </div>
          <div class="mt-2 message-content">${marked.parse(message)}</div>
        `;
        
        previewModal.classList.remove('hidden');
      }
    });
    
    // Close preview modal and edit message
    editMessageBtn.addEventListener('click', () => {
      previewModal.classList.add('hidden');
    });
    
    // Confirm and post message
    confirmPostBtn.addEventListener('click', () => {
      const name = nameInput.value.trim() || 'Anonymous';
      const message = messageInput.value.trim();
      const category = categorySelect.value;
      const mood = selectedMoodInput.value;
      const color = selectedColorInput.value || 'bg-white';
      
      // Add new message to Firebase
      messagesRef.push({
        name,
        message,
        category,
        mood,
        color,
        timestamp: Date.now(),
        likes: 0
      }).then(() => {
        // Clear form
        nameInput.value = '';
        messageInput.value = '';
        categorySelect.value = 'general';
        selectedMoodInput.value = '';
        selectedColorInput.value = 'bg-white';
        
        // Clear mood selection UI
        document.querySelectorAll('.mood-selector').forEach(btn => {
          btn.classList.remove('bg-indigo-100');
        });
        
        // Clear color selection UI
        document.querySelectorAll('.color-selector').forEach(btn => {
          btn.classList.remove('border-indigo-600');
        });
        document.querySelector('.color-selector[data-color="bg-white"]').classList.add('border-indigo-600');
        
        // Close preview modal
        previewModal.classList.add('hidden');
        
        // Update character count
        charCount.textContent = '0/500';
        
        // Celebrate!
        celebrate();
      });
    });
    
    // Close preview modal when clicking close button
    closePreviewBtn.addEventListener('click', () => {
      previewModal.classList.add('hidden');
    });
    
    // Load and display messages
    function loadMessages() {
      messagesList.innerHTML = `
        <div class="text-center text-gray-500 py-8">
          <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
          <p>Loading messages...</p>
        </div>
      `;
      
      messagesRef.once('value', (snapshot) => {
        const messages = snapshot.val();
        messagesCache = [];
        
        if (messages) {
          // Convert messages to array
          const messagesArray = Object.entries(messages).map(([id, data]) => ({
            id,
            ...data
          }));
          
          // Apply filter
          const currentFilter = filterCategory.value;
          let filteredMessages = currentFilter === 'all' 
            ? messagesArray 
            : messagesArray.filter(msg => msg.category === currentFilter);
          
          // Apply search
          const searchTerm = searchMessages.value.toLowerCase().trim();
          if (searchTerm) {
            filteredMessages = filteredMessages.filter(msg => 
              msg.message.toLowerCase().includes(searchTerm) || 
              msg.name.toLowerCase().includes(searchTerm)
            );
          }
          
          // Apply sort
          const currentSort = sortBy.value;
          switch(currentSort) {
            case 'newest':
              filteredMessages.sort((a, b) => b.timestamp - a.timestamp);
              break;
            case 'oldest':
              filteredMessages.sort((a, b) => a.timestamp - b.timestamp);
              break;
            case 'popular':
              filteredMessages.sort((a, b) => (b.likes || 0) - (a.likes || 0));
              break;
          }
          
          messagesCache = filteredMessages;
          
          // Handle pagination
          displayMessages();
        } else {
          messagesList.innerHTML = `
            <div class="text-center text-gray-500 py-8">
              <i class="fas fa-comment-slash text-4xl mb-2"></i>
              <p>No messages yet. Be the first to post!</p>
            </div>
          `;
          loadMoreBtn.classList.add('hidden');
        }
        
        // Update stats
        updateStats(snapshot.val() || {});
      });
    }
    
    // Display messages with pagination